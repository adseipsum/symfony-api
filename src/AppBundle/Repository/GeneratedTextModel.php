<?php

namespace AppBundle\Repository;

use AppBundle\Entity\CbGeneratedText;
use Rbl\CouchbaseBundle\Base\CbBaseModel;
use Rbl\CouchbaseBundle\CouchbaseService;
use Rbl\CouchbaseBundle\Base\CbBaseObject;

class GeneratedTextModel extends CbBaseModel
{

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    // Views Section
    const DISDOC_ID = "generated_text";

    const VIEW_BY_TEMPLATE_ID = 'templateId';

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function __construct(CouchbaseService $service)
    {
        parent::__construct('generate-text', 'GeneratedText', $service->getBucketForType('GeneratedText'));
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function factory() : CbBaseObject
    {
        $ret = new CbGeneratedText();
        return $ret;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function getDisdocId() : string
    {
        return self::DISDOC_ID;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function listObjectsByTemplateId(string $templateId)
    {
        $objectIds = $this->listObjectIdByView(self::VIEW_BY_TEMPLATE_ID, $templateId);
        return $this->get($objectIds);
    }
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function listObjectIdByTemplateId(string $templateId)
    {
        return $this->listObjectIdByView(self::VIEW_BY_TEMPLATE_ID, $templateId);
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public function getGeneratedTextFromTemplateCount(string $templateId)
    {
        return count($this->listObjectIdByView(self::VIEW_BY_TEMPLATE_ID, $templateId));
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}
